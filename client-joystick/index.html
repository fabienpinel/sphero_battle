<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="stylesheet" href="./components-font-awesome/css/font-awesome.min.css"/>
    <style>
        button {
            width: 50px;
            height: 50px;
        }
        table {
            bottom:0px;
            position: absolute;
            margin:auto;
            left: 50%;
            top: 50%;
            transform : translate(-50%, -50%);
        }
    </style>
</head>
<body>

<table>
    <tr>
        <td><button onclick="go(45)"><i class="fa fa-arrow-left"></i><i class="fa fa-arrow-up"></i></button></td>
        <td><button onclick="go(90)"><i class="fa fa-arrow-up fa-2x"></i></button></td>
        <td><button onclick="go(135)"><i class="fa fa-arrow-up"></i><i class="fa fa-arrow-right"></i></button></td>
    </tr>
    <tr>
        <td><button onclick="go(0)"><i class="fa fa-arrow-left fa-2x"></i></button></td>
        <td><button onclick="stop()"><i class="fa fa-dot-circle-o"></i></button></td>
        <td><button onclick="go(180)"><i class="fa fa-arrow-right fa-2x"></i></button></td>
    </tr>
    <tr>
        <td><button onclick="go(315)"><i class="fa fa-arrow-left"></i><i class="fa fa-arrow-down"></i></button></td>
        <td><button onclick="go(270)"><i class="fa fa-arrow-down fa-2x"></i></button></td>
        <td><button onclick="go(225)"><i class="fa fa-arrow-down"></i><i class="fa fa-arrow-right"></i></button></td>
    </tr>
</table>

<script>
    /*interval = setInterval(function(){

        var deltaX = joystick.deltaX();
        var deltaY = joystick.deltaY();
        var http = getAjax();
        http.open('PUT', 'http://localhost:8080/move/', true);
        xmlhttp.setRequestHeader("Content-type","application/json");
        http.send(JSON.stringify({
            deltaX: deltaX,
            deltaY: deltaY
        }));
        console.log(deltaX, deltaY);
    }, 1/30 * 1000);*/

    var distance = 500;
    var departureAngle = 0;
    function go (angle) {
        var http = getAjax();
        http.open('POST', 'http://localhost:8080/move/' + parseInt(angle + departureAngle) + '/' + parseInt(distance), true);
        xmlhttp.setRequestHeader("Content-type","application/json");
        http.send();
    }

    function stop() {
        var http = getAjax();
        http.open('POST', 'http://localhost:8080/move/0/0', true);
        xmlhttp.setRequestHeader("Content-type","application/json");
        http.send();
    }

    function getAjax () {
        if (window.XMLHttpRequest)
        {// code for IE7+, Firefox, Chrome, Opera, Safari
            return xmlhttp=new XMLHttpRequest();
        }
        else
        {// code for IE6, IE5
            return xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
        }
    }
/*
    var clicked = false;
    document.addEventListener('mousedown', function () {
        clicked = true;
    });
    document.addEventListener('mouseup', function () {
        clicked = false;
        angle = null;
        distance = null;
    });

    var angle = null;
    var distance = null;
    document.addEventListener('mousemove', function (e) {
        if (clicked) {
            var pointerX = -e.clientX;
            var pointerY = e.clientY;
            var centerX = -window.innerWidth / 2;
            var centerY = window.innerHeight / 2;

            angle = (57.2958 * Math.atan((pointerY - centerY) / (pointerX - centerX)));
            distance = Math.sqrt((pointerX - centerX)*(pointerX - centerX) + (pointerY - centerY)*(pointerY - centerY));

            if (pointerX > centerX && pointerY < centerY) {
                //console.log('// en haut à droite', Math.abs(angle));
                angle =  Math.abs(angle);
            } else if (pointerX > centerX && pointerY > centerY) {
                //console.log('// en bas à droite', 360 - Math.abs(angle));
                angle = 360 - Math.abs(angle);
            } else if (pointerX < centerX && pointerY < centerY) {
                //console.log('// en haut à gauche', 180 - angle);
                angle =  180 - angle;
            } else if (pointerX < centerX && pointerY > centerY) {
                //console.log('// en bas à droite', 180 + Math.abs(angle));
                angle = 180 + Math.abs(angle)
            }
            console.log(angle, distance);
            //go(angle, distance);
        }
    });

    setInterval(function () {
        if (angle && distance) go(angle, distance * 2);
    }, 100);*/

    document.addEventListener('keydown', function (e) {
        console.log(e.which);
        if (e.which == 39) { // droite
            go(180, 500);
        } else if (e.which == 37) { // gauche
            go(0, 500);
        } else if (e.which == 40) { // bas
            go(270, 500);
        } else if (e.which == 38) { // haut
            go(90, 500);
        }
    })

</script>
</body>
</html>